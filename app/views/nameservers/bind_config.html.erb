# Bind Configuration
# Server System: <%=h @config['server_system'] %>
# Nameserver Name: <%=h @nameserver.name %>/<%=h @nameserver.id %>
# Nameserver Config: <%=h @config['server_config'] %>
# END

<% @nameserver.domain_nameservers.each do |zone| %>

<% if zone.nstype == "master" %>
# Zone: <%= zone.domain.name %> ; Type: <%= zone.nstype %>
zone "<%= zone.domain.name %>" IN {
    type <%= zone.nstype %>;
    file "/etc/bind/zones/<%= zone.nstype %>/<%= zone.domain.name %>";
    notify yes;
    allow-transfer {
       127.0.0.1;
       ::1;
       <% zone.domain.domain_nameservers.each do |ns| %>
       # Nameserver: <%= ns.nameserver.name %>
       <%= ns.nameserver.ip %>;<% end %>
    };
};
<% end %>

<% if zone.nstype == "slave" and zone.domain.getMaster %>
zone "<%= zone.domain.name %>" IN {
    type <%= zone.nstype %>;
    # <%= zone.domain.getMaster.nameserver.name %>
    masters { <%= zone.domain.getMaster.nameserver.ip %>; };
};
<% end %>

<% end %> <%# END of WHILE%>